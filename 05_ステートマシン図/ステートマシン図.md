# ステートマシン図

## ステートマシン図の概要

  * ステートマシン図はオブジェクトの「状態」を表現する。

  * オブジェクトの状態とは
    * オブジェクトはデータ（属性）と振る舞い（操作）と状態を持つ。たとえば、エアコンの設定温度を考えた場合、次の3つの状態が考えられる。
      * エアコンの設定温度が実際の温度より高いとき
      * エアコンの設定温度と実際の温度が同じとき
      * エアコンの設定温度が実際の温度より低いとき

    * ステートマシン図は複雑な状態を持ったクラスについてのみ作成する。（ビジネス系ではあまり必要性を感じないかもしれないが、組み込み系では必須。

## ステートマシン図とは
  * 相互作用図では、ライフライン同士におけるメッセージやり取りで、システムの動的な振舞いを表現してきた。それに対してステートマシン図では、1つのオブジェクトが生成から消滅までに、時間の経過に伴って変化する状態について表現する。

  * さきほどのエアコンの設定温度をステートマシン図で考えると、「設定温度が実際の温度より高い状態」、「設定温度と実際の温度が同じ状態」、「設定温度が実際の温度より低い状態」の3つの状態があり、そのトリガによって変わることを表現している。

  * ![statemachine_01](src/statemachine_01.png)


## 状態
  * オブジェクトの生成から消滅までの中で、ある一定時間とどまる状況のことを、状態という。状態は丸い長方形で表現し、その中に状態名を記述する。

  * ![statemachine_02](src/statemachine_02.png)

## 開始状態
  * 開始状態はステートマシン図の開始時点（オブジェクト生成時）を示す特別な状態。図中では黒丸で表現する。

  * 開始状態はコンポジット状態の開始時点で示す特別な状態でもある。

    * ![statemachine_03](src/statemachine_03.png)

  * コンポジットの状態がない限り開始状態は一つだけ表記する。終了状態は必用な数だけいくらでも記入できる。

    * ![statemachine_04](src/statemachine_04.png)

## 終了状態
  * 終了状態はステートマシン図の終了時点（オブジェクト消滅時）、または状態が階層化されているときに、そのレベルの終了時点を示す特別な状態。図中では中の丸を塗りつぶした2重丸で表記する。 

  * ![statemachine_05](src/statemachine_05.png)

## トリガ
  * トリガはある状態に対し、何らかの影響をもたらす事象の発生のこと。

  * トリガが発生すると、遷移が起こる。

  * 次の例は、洗濯機の状態の一部で、「注水」の状態から「満水」というトリガが発生すると、「洗濯」状態になる。

  * ![statemachine_06](src/statemachine_06.png)

## 状態遷移
  * 「注水」の状態から「洗濯」の状態に変わったようにある状態からある状態へ変わることを、状態遷移という。

  * ![statemachine_07](src/statemachine_07.png)

## 自己遷移
  * 自分自身の状態に入りなおすことを自己遷移という。

  * ![statemachine_08](src/statemachine_08.png)

## 完了遷移（トリガレス遷移）

  * トリガではなく、アクションやアクティビティの終了をきっかけとして他の状態に遷移することを、完了遷移という。次の例は、テープの「巻き戻し」状態で「テープの巻き戻し」アクティビティが起動し、それが終了次第「停止」状態に遷移することを示している。

  * ![statemachine_09](src/statemachine_09.png)

## ガード状態

  * 複数のトリガがある場合、どちらに分岐すべきかを指定するために、トリガの後ろにガード条件を記述する。ガード条件は **[]** で囲んで記述する。

  * ![statemachine_10](src/statemachine_10.png)

## エフェクト

  * トリガが起きて、遷移状態が発生したときに、稼働する動作をエフェクトとして指定することができる。エフェクトは次のフォーマットに従って記述する。
    * **トリガ[ガード条件]/エフェクト**

  * ![statemachine_11](src/statemachine_11.png)

## 入場アクション／退場アクション

  * 状態に入るときに起動するアクションを **入場アクション** 、状態から出るときに起動するアクションを **退場アクション**として記述できる。

  * 入場アクションは **entty/** 退場アクションは **exit/** に続けて記述する。

  * 次の状態は「注水」状態に入ると「注水口が開く」が実行され、「注水」状態から出ると、「注水口が閉じる」が実行される。

  * ![statemachine_12](src/statemachine_12.png)

## アクティビティ

  * **アクティビティ** は状態に入ると開始され、状態から抜け出す（または動作完了）まで継続的に行われる操作。次の例では「注水」状態に入ると注水が開始し、「注水」状態から出るまで注水が継続される。

  * ![statemachine_13](src/statemachine_13.png)
