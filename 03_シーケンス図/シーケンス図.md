# シーケンス図

## 相互作用図

 * 「もの」、「ひと」同士のメッセージのやり取りを表現する図で、ユースケース図の具体例として記述したシナリオに沿って作成する。
 * シナリオには日本語の文章を箇条書きで記述するが、相互作用図では「もの」や「ひと」（ライフライン）同士のメッセージのやり取りとして表現する。

 * 相互作用図の種類

   * シーケンス図
    
     * 上から下に、時系列に沿った処理の流れをメッセージのやり取りとして表現する。

   * コミュニケーション図
     
     * ライフライン同士の接続関係に着目しつつ、関係しているライフライン同士のメッセージのやり取りを表現する。
    
    * シーケンス図とコミュニケーション図の使用順序は特に定められておらず、上記の特徴を理解し、使用しやすい方を先に使用する。必用がなければ、どちらか一方でも可

## シーケンス図とは

  * ![sequence_1](src/sequence_1.png)

  * ライフライン同士のメッセージを上から下に、順番に配置する。

  * 処理の順番が明確な場合に時系列に沿って処理の流れを記述するのに適している。

  * ビジネスシステムは、処理の流れが明確な場合が多い為、シーケンス図がよく利用されている。

  * シーケンス図を描くときは、メッセージが左から右に流れ、見やすいようにライフラインを配置する。


## ライフライン

  * ライフライン 
    * ライフラインは相互作用の参加者を表現する。ライフラインは長方形で表現し、長方形から下に向かって点線を引く。点線はライフラインが存在している期間を表す

  * ライフラインの生成と消滅
    * ライフラインの点線がライフラインの生存期間を示すので、ライフラインを生成するメッセージは、ライフラインに対して点線矢印を直接引く。また、ライフラインの消滅を示すには、×印をライフラインの点線の末端に記述する。
      * ![sequence_2](src/sequence_2.png)

  * ライフラインの表記
    * ライフラインは長方形の中にライフライン名を記述して表現する。
    * ライフラインは「役割のみ」、「役割名とクラス名」、「クラス名のみ」の3通りで表記することができる。
      * ![sequence_3](src/sequence_3.png)

## メッセージ

  * メッセージ
    * ライフライン間のコミュニケーション（情報のやり取り）を表現するには、2つのライフラインの点線間にメッセージの矢印を引く。矢印の表記には「先端を塗りつぶした矢印」(同期メッセージ)、「矢印」（非同期メッセージ）、「点線矢印」（戻り（リプライ））の3種類がある。また、メッセージラベルをつける。
      * ![sequence_4](src/sequence_4.png)

  * 先端を塗りつぶした矢印
    * **同期メッセージ（階層化しているメッセージ）** を表す。次の場合「M1」の呼び出し終了を待って「M3」の呼び出しを行う。
      * ![sequence_5](src/sequence_5.png)

  * 矢印
    * **非同期メッセージ（階層化していないメッセージ）** を表す。次の場合「M1」の呼び出し終了をまたずに、「M3」を呼び出す。 
      * ![sequence_6](src/sequence_6.png)

  * 点線矢印
    * 同期メッセージの戻り（リプライ）を表す。次の「R1」、「R2」、「R3」それぞれ「M1」、「M2」、「M3」に対する戻り（リプライ）を表現している。
      * ![sequence_7](src/sequence_7.png)


## シーケンス図の応用表記（1）

  * 相互作用使用
    * 相互作用使用を用いることで、ある相互作用から他の相互作用を参照することができる。フレームヘッダに"ref"を入れ、フレームの中に、参照先の相互作用名を書く。 
      * ![sequence_8](src/sequence_8.png)

  * 処理の分岐
    * フレームヘッダに「alt」を入れると、分岐を表現することができる。フレームを破線で区切り、分岐する条件をガードで表現します。ガードは"[ ]"内に条件を記述します。
      * ![sequence_9](src/sequence_9.png)

  * 処理の繰り返し
    * フレームのヘッダに"loop"を入れることで、処理の繰り返しを表現することができる。"loop"の後に繰り返し数を"[]"に入れて記述する。
      * ![sequence_10](src/sequence_10.png)

  * 平行処理
    * フレームヘッダに"par"を入れることで、並行処理を表現することができる。
      * ![sequence_11](src/sequence_11.png)

  * 統合フラグメントについて
    * 「alt」、「loop」、「par」は統合フラグメントと呼ばれる。

## シーケンス図の応用表記（2）

  * 拾得メッセージ、消失メッセージ
  
    * 拾得メッセージ
      * 拾得メッセージは送信側が明確ではないときに使用する。拾得メッセージは塗りつぶした円から矢印を引く

    * 消失メッセージ
      * 消失メッセージは受信側が明確でないときに使用する。消失メッセージは矢印の先に塗りつぶした円を配置する。 

  * 再帰呼び出し
    
    * あるライフラインが自分自身に対してメッセージを送信する場合、再帰呼び出しで表現する。再帰呼び出しは、ライフラインの点線から出たメッセージを折り曲げて表記する。

  * ![sequence_12](src/sequence_12.png)


## 実行指定

  * 実行指定はあるメッセージ（操作）の呼び出しの制御を表現する。同時にそのメッセージ（操作）の実行期間も表現する。

  * 次図では「M1」が「M2」と「M4」の呼び出しを、「M2」が「M3」の呼び出しを制御している事を示している 

  * ![sequence_13](src/sequence_13.png)


## シーケンス図とクラス図の関係

  * 責務

    * シーケンス図でのメッセージの送信は、**受信側のライフラインにおける、クラスの操作（責務）を呼び出す**ことで表現できる。次の図での最初のメッセージ「検索(ID)」は、「会員管理」クラスの操作を呼び出している。3番目の「表示()」は「画面」クラスの操作を呼び出している。
        
      * 「:画面」クラス内のメソッドで、「会員管理」インスタンスの「検索(ID)」メソッドを呼び出しているイメージ。

      * メッセージ送信を単純にクラスとしてでじゃなく、イベントとして実装する場合もある。

      * **シーケンス図のライフライン間でメッセージの送信が行われている場合、そのライフラインに対応するクラスに、メッセージに対応する操作を定義する。**

    * ![sequence_14](src/sequence_14.png)
    * ![sequence_15](src/sequence_15.png)
  

## 関連

  * シーケンス図において、2つのライフライン間にメッセージのやり取りが行われている場合、対応する2つのクラス間には、何らか関係（関連・集約・依存など）が存在している。

  * 逆にいえばクラス間に何らかの関係があったので、ライフライン間でメッセージを送信することができたということ

  * ライフライン間にメッセージの送信が行われている場合、対応するクラス間には、何らかの関係がある。
